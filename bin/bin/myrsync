#!/bin/bash
DRYRUN=$1

if [ "$DRYRUN" = "dry" ]; then
	DRYRUNCMD="--dry-run"
	echo "Dry run initiated..."
fi

mysync()
{
	for path in $1; do
		sourcepath="${path%:*}"
		destpath="${path#*:}"
		[ -d "$destpath" ] || mkdir -p "$destpath"
		rsync -avz -e "ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" --progress $DRYRUNCMD --files-from=<(\
		ssh kyle@ns535640.ip-158-69-246.net "find $sourcepath $2 -type f | sed 's|$sourcepath||'") \
		kyle@ns535640.ip-158-69-246.net:/$sourcepath $destpath/
	done
}

PATHS="/home/kyle/no_snapshot/plex/movies/:/data/plex/media/movies/"
mysync $PATHS "-mtime -182"	# 26 weeks

PATHS="/home/kyle/no_snapshot/plex/tv/:/data/plex/media/tv/"
mysync $PATHS "-mtime -42"	# 6 weeks

PATHS="/home/kyle/no_snapshot/nzbget/:/data/nzbget/downloads/"
PATHS+=" /home/kyle/no_snapshot/transmission/:/data/transmission/downloads/"
mysync $PATHS	# no time limit

exit 0

PATHS="/home/kyle/mediaserver/volumes/hydra/config/:/data/hydra/config/"
PATHS+=" /home/kyle/mediaserver/volumes/letsencrypt/config/:/data/letsencrypt/config/"
PATHS+=" /home/kyle/mediaserver/volumes/nzbget/config/:/data/nzbget/config/"
PATHS+=" /home/kyle/mediaserver/volumes/plex/config/:/data/plex/config/"
PATHS+=" /home/kyle/mediaserver/volumes/plexpy/config/:/data/plexpy/config/"
PATHS+=" /home/kyle/mediaserver/volumes/portainer/data/:/data/portainer/config/"
PATHS+=" /home/kyle/mediaserver/volumes/radarr/config/:/data/radarr/config/"
PATHS+=" /home/kyle/mediaserver/volumes/sonarr/config/:/data/sonarr/config/"
PATHS+=" /home/kyle/mediaserver/volumes/transmission/config/:/data/transmission/config/"
mysync $PATHS	# no time limit
